% This is samplepaper.tex, a sample chapter demonstrating the
% LLNCS macro package for Springer Computer Science proceedings;
% Version 2.20 of 2017/10/04
%
\documentclass[runningheads]{llncs}
%
\usepackage{graphicx}
\graphicspath{ {./img/} }

\input{solidity-highlighting.tex}	% copy the file from this repo
% Used for displaying a sample figure. If possible, figure files should
% be included in EPS format.
%
% If you use the hyperref package, please uncomment the following line
% to display URLs in blue roman font according to Springer's eBook style:
% \renewcommand\UrlFont{\color{blue}\rmfamily}

\begin{document}
%
\title{Ants-Review: A Protocol For Open Anonymous Peer-Reviews}
%
%\titlerunning{Abbreviated paper title}
% If the paper title is too long for the running head, you can set
% an abbreviated paper title here
%
\author{Bianca Trovò\inst{1,2}\orcidID{0000-0002-6776-2304}\thanks{Correspondent author} \and
Nazzareno Massari\inst{3,4}\orcidID{0000-0002-6638-2174}}
%
\authorrunning{B. Trovò et N. Massari}
% First names are abbreviated in the running head.
% If there are more than two authors, 'et al.' is used.
%
\institute{Sorbonne Université, Faculté des Sciences et Ingénierie, 75005 Paris, France \and
Neurospin research center, CEA/SAC/DSV/I2BM, 91191 Gif-sur-Yvette, France
\email{bianca.trovo@alumni.unitn.it}\\
\and
Alma Mater Politecnico di Torino, 10129 Turin, Italy\and
Independent Blockchain Engineer, London, UK \\
\email{nazzareno@nazzarenomassari.com}}
%
\maketitle              % typeset the header of the contribution
%
\begin{abstract}
Peer-review is a necessary and essential quality control step for scientific publications. However, the process, which is very costly in terms of time investment, not only is not remunerated but it’s also not recognized by the academic community as a relevant scientific output for a researcher. Therefore, scientific dissemination is affected. Here, to solve this issue we propose a blockchain-based incentive protocol that rewards scientists also for their contributions to other scientists’ work and that builds up a reputational system. We designed a basic Bounty-like contract called AntsReview that allows any author to issue a call for peer-reviewing their scientific publication. If requirements are met, peer-reviews will be audited by an external editor and payed by the Issuer. To promote ethical behaviour the system will implement a quadratic funding on AntsReview.
\keywords{Blockchain  \and Peer-review \and Privacy \and Incentivization.}
\end{abstract}
%
%
\section{Introduction}
blockchain for science here and application to open science and to peer review as a specific case

An increasing body of voices in the scientific community has started to speak up for the need of updating current scientific practices with the advances represented by blockchain technology [2, 8]. As an example, we refer to a ‘manifesto’ written by a few anonymous authors, proposing a blockchain based system of academic endorsement (AES) [1]. Indeed, we could say that in general “specific blockchain characteristics meet the requirements of an open science infrastructure” [3-7]:
\paragraph{Decentralisation}Taking out the need of intermediaries, would make useless depending on highly profiting publishing companies for disseminating scientific work and managing the rules of the peer-review process;
\paragraph{Immutability} of the system in which information can only be appended with tamper proof-time stamping,  but not subsequently modified, would secure the intellectual property and a fairer measure of the scientific contribution of the actors at play during the multiple versions of a paper;
\paragraph{Transparency} (meaning that we have a viewable record of all the transactions), would also make editorial decisions (publish or not publish a study) more transparent and democratic. Finally, cryptographic hashing could allow for a double-blind process that reduces human biases in judgement by assigning hashed pseudonymous to universal researcher identifiers. From all these aspects taken together, a more democratic open peer-review  process could rise, in which merit and power (of access to information, of decision…) is more equally redistributed among the stakeholders (researchers, reviewers, taxpayers).

\section{Background}
\subsection{Peer-review: a flawed and outdated system}
Peer-review is the traditional and necessary process at the heart of quality control in science [9, 12], determining the destinies of articles’ publications and therefore of scientific dissemination. However, the current peer-review system is outdated: in the past, it was effective when scholarly communication happened exclusively through printed paper journals, but nowadays, with the high and fast-paced levels of articles productions, its slow and multistage process doesn’t keep up with the times.
\subsubsection{It's a slow multi-stage process.} Indeed, articles submitted to journals can take from months to years after editors’ first scrutiny, going back and forth several review rounds before acceptance for publications.
\paragraph{Traditional peer-review process} This section takes inspiriration from the editorial processes at Nature Methods and Wiley.
\begin{enumerate}
    \item The author submits a manuscript to the journal.
    \item  An editorial team  assesses the paper for what concerns the requirements of the journal's Author's Guideline (composition, sections...).
    \item An Editor in Chief (EIC) is assigned to the manuscript and checks if the paper meets the scopes of the journal and novelty criteria. If the paper is rejected, it does not go through the consideration process and the editor notifies the author.
    \item If the editorial decision is to send the manuscript for review, the handling editor looks for potential reviewers. Potential reviewers can be suggested by the authors themselves, but usually it's up to the editor to find researchers in the field who are competent enough but not closely related to the study to review.
    \item Candidate reviewers receive the journal's invitation and evaluate acceptance based on their own level of expertise, intrinsic conﬂicts of interest and time availability. They then accept or decline. If they decline, they might suggest alternative reviewers. Editors keep searching for reviewers until they find two or three reviewers who agree to review the manuscript.
    \item When reviewers engage themselves in delivering peer-review report by a certain deadline, the author(s) are notified. The reviewers identity is usually only know to the editor but is hidden to the authors or the other reviewers themselves.
    \item Reviewers independently conduct their reviews by exposing in their reports strengths and weaknesses of the manuscript in a point-by-point fashion and submitting a final recommendation to the editor: acceptance, rejection or revision (major or minor).
    \item the handling editor or the editorial team considers all the submitted reports and makes the final decision.
    \item If the decision is a major or minor revision, authors are invited to re-submit a corrected or improved version of the manuscript with a letter to the reviewers. The same reviewers might be contacted again and if they want they can follow up the peer-review process.
    \item If the decision is a rejection, the editor might indicate another journal where to submit the manuscript.

\end{enumerate}
\subsubsection{It's unaccredited and unpaid.} This is mainly due to the fact that the reviewers that are normally appointed by authors and/or editors are actually full-time researchers themselves, who work on a volunteer basis taking time from their primary research. Though things are changing, and now more and more journals encourage a transparent peer review process with the publication of reviewers names and reports, in most of the cases, to guarantee an unbiased output, journals don’t even get credit researchers for this form of unpaid work. On top of this, author-level metrics that measure the scientific impact and productivity of academics, such as the h-index, and are taken into account by the funding agencies, are purely based on the number of citations per each publications while neglecting the full spectrum of scientific contributions (software, data collection, presentations, reviews…). Therefore, peer-reviewing is an intellectual investment without any external return for researchers’ career. A major consequence of not promoting incentives for the quality (and quantity) of peer-reviews is to either have good research unpublished (because unreviewed) and abandoned in preprint archives or bad science published through sloppy and uncritical reviews [5].
\subsubsection{It's vulnerable to bias and fraud.} Last but not least, the ‘publish or perish’ culture has been more and more inducing malicious behaviour during the peer-review process, such as attempts of scientific fraud (authors trying to review their own papers) and abuse (reviewers producing extremely harsh reviews to damage competitors by blocking the publication of their ideas). Finally, the current peer-review system is usually not double-blind, thus making its decisional process vulnerable to all forms of biases (gender bias, cultural bias, professional bias, etc...). These trust problems are one of the major issues facing scholarly communication.

\subsubsection{Types of peer-review}
\begin{itemize}
    \item single-blind peer review
    \item double-blind peer review
    \item transparent peer review
    open identities open reports open participation open interaction open platform ('decoupled review')
\end{itemize}



\subsection{Related work}
Credit for peer review is not a new thing: mostly journals handled it so far with virtual 'badges', certificates of performance, citation in annual editorials but none of these is standardized in a way that has a weight for funders world ranking bodies institutions like imapct factor h-index.
In relation to security issues \emph{CryptSubmit} \emph{MaRSChain}
\emph{Crossref} primary DOI provider, announced that review reports could be now registered as part of their services
\emph{Publons} provides a way to keep track of the reviews records and integrate them into academic profiles such as ORCID
ScienceOpen
\emph{DEIP}
Rubriq provides independent and standardized peer review that can be accepted and shared across all types of journals and distribution systems. Now absorbed by Research Square.
\emph{Peerage of Science} that provides a journal-independent free service for scientific peer review and publishing. The interesting feature is that it provides also a peer-review of the reviews.
\emph{Blockchain for Peer Review,}pilot project sponsored by Digital Science and Katalysis, aims at developing a protocol for storing peer reviews submitted by publishers on a blockchain such that review process can be independently verified and review info is fed to ORCID researcher profiles []
\emph{ReviewCoin}
\emph{I8X Platform}


\subsection{Blockchain solution}

\section{System concept}
For the above mentioned reasons, we propose an incentive-based protocol called Ants-Review to reward open peer-reviews while preserving the anonymity of the reviewers. The name originates from the idea that the work behind a finished scientific paper resembles a complex organism such as an anthill, which emerges from the sum of many individualities: in it, all contributions (even if ‘micro’) are essential to the whole and are worth recognition.
This project is intended to be open source and was developed during the ETH Turin 2020 Hackathon and it’s design and attempt of implementation are exposed in the following section.

\subsubsection{Accountability} hash
\subsubsection{Reward} bounty
\subsubsection{Quadratic Voting} I don't see the point of introducing QF here. Is it already implemented or it's just in the idea?

\subsubsection{Privacy/anonymity}. To protect the contributors privacy, we would like to implement on the ANT token a fast, non-interactive type of zero-knowledge privacy protocol to enable private transactions on Ethereum. Zero-knowledge proof is a mathematical cryptographic method that through values permutations allows one party (the prover) to prove to another (the verifier) the veracity of a statement, without having to reveal what the statement is. We will use ZK-SNARKs (which stands for “Zero-Knowledge Succinct Non-Interactive Argument of Knowledge”) via the open source libraries of AZTEC protocol. AZTEC, now TURBOPLONK bla bla (faster?) combines the confidentiality of the transactions (the value of the transaction is hidden, the amount of token (?) is not revealed thus preventing biases in the peer-review quadratic voting process = "I want to bet on this review because I want to win the bounty") with general-purpose computation (it's a Turing-complete Virtual Machine): this means transaction are not limited just to the local cryptocurrency (in our case ANT) but cross-asset trades are allowed (I can exchange ANT tokesn with other crypto-currencies).



\subsection{Design}

\subsubsection{AnstReview process: scenario 1 (journal-dependent)}

\begin{enumerate}
    \item The author submits a manuscript to the journal.
    \item If the papers passes stage 2-3 of editorial decision (appropriateness of style and coherence with the journal's scope)
    \item the editor issues a bounty (\emph{bounty issuance}) for the paper review. Fulfillment rules are set in a smart-contract.
    \item (footnote?) the bounty prize could correspond to part of the article submission fees and article publication fees requested to the authors by the journal.
    \item Reviews fulfilling the smart-contract requirements are validated by the journal editors.
    \item When the reviews are accepted (\emph{bounty fulfillment}), reviewers awarded a token called \emph{ANT}.
    \item Not all reviews will have the same quality and depth. However, each of them might bring up one or more relevant contribution for the sake of improving the manuscript. In order to redistribute the bounty in a fair manner across reviewers, reviews will be voted by the editors with Quadratic Voting.********* POINT OF FAILURE? who votes?

\end{enumerate}

\subsubsection{AnstReview process: scenario 2 (community-driven)}:

\begin{enumerate}
    \item The author submits a manuscript to the pre-print service or to an hypothetical AntsReview platform).
    \item The paper is accepted by the community for revision in its whatever format.
    \item The author issues a bounty (\emph{bounty issuance}) for the paper review. Fulfillment rules are set in a smart-contract.
    \item (footnote?) the bounty prize could come by a community stake that participates in the peer-review process either as a reviewer or as a reviewer checker.
    \item Reviews fulfilling the smart-contract requirements are validated by the AntsReview community/contributors.
    \item When the reviews are accepted (\emph{bounty fulfillment}), reviewers awarded a token called \emph{ANT}.
    \item Not all reviews will have the same quality and depth. However, each of them might bring up one or more relevant contribution for the sake of improving the manuscript. In order to redistribute the bounty in a fair manner across reviewers, reviews will be voted by the community with Quadratic Voting.
    \item In order to incentive 'fair play' also the review checkers who vote for the best quality reviews will share the final prize from the bounty. Since it's in their own interest to 'bet' on a good review, this gamed system will discourage internal dynamics prompt to favour specific members of the community beyond real personal merit. It will also fuel ethical behaviour.

    \end{enumerate}

peer-review is decoupled from journal
or


\subsection{Implementation}

\begin{figure}
\centering
\includegraphics[scale=0.28]{AntsReview}
\caption{AntsReview Smart Contracts}
\label{fig:contracts}
\end{figure}


AntsReview [Fig.\ref{fig:contracts}] is a distributed peer-review system which synthesizes successful ideas from previous systems including The Bounty Network[ref], ERC20[ref], AZTEC Protocol[ref], IPFS[ref], Proof of Existence[ref], ...
\newline The contribution of AntsReview is simply allowing the peer-review process, as a complex system, to emerge as a self-organised ecosystem of authors and peer-reviewers to enhance the complexity of a paper and its validation.
\newline AntsReview represent a new platform to issue peer-reviews and validate scientific papers and a new system for anonymous and open contributions with an incentivization mechanism to reach an ideal state of equilibrium and create value.
\newline The AntsReview Protocol is divided into stack of sub-protocols responsible for different functionality:

\begin{enumerate}
  \item \textbf{Bounty} - manage access management and the basic system.
  \item \textbf{Tokenomics} - manage system incentivization mechanism integrating ideas from DeFi and Quadratic Funding.
  \item \textbf{Privacy} - maintains the anonymity of the system via AZTEC Protocol.
\end{enumerate}

\subsubsection{Bounty}
AntsReview [\ref{appendix:b}] is the core of the smart contracts deployed on Ethereum Rinkeby's Testnet as shown in the flow-chart[img].
\newline It implements a Bounty-like system where an issuer (author) is asked a series of actions, to ensure transparency and robustness, regarding the AntReview that he's creating:
\begin{itemize}
  \item to upload the file containing the requirements of the peer-review and the paper into IPFS.
  \item to specify a deadline in the form of a unix timestamp after which the fulfillment will no longer be accepted.
  \item to send the amount of ether for the reward.
\end{itemize}

AntsReviewRoles[appendix A], to ensure integrity of the system, implements an access management, leveraging on AccessControl.sol by OpenZeppelin Library, through the creation of the Roles Issuer and Peer-Reviewer[code].
\newline It also integrates a circuit breaker deisgn pattern via Pausable.sol by OpenZeppelin to allow the Pauser Role, that by default is the Owner of the Smart Contracts, to pause (or unpause) the functions in case of emergency.
\newline In this way, only the Issuer (author) can create a new AntReview.
\newline Once created, an AntReview is available to be fulfilled by Peer-Reviewers, uploading the peer-review on IPFS before the deadline.
\newline The AntReview after being validated is then accepted by the Issuer and paid equally between Peer-Reviewers.
\newline Also, the Issuer can cancel the AntReview at any time and withdraw the amount of ether staked.
\newline One of the key aspects of the protocol is the concept of Proof of Existence, introduced by Stuart Haber \& W. Scott Stornetta with the paper "How to time-stamp a digital document".
\newline As the pioneers of blockchain an cited by Bitcoin whitepaper, they were in a mission to solve the problem of immutability of digital records that became reality with the Blockchain and Bitcoin as its first application.
\newline In Ethereum the concept of immutability is achieved via the blockchain and proof of work consesus algorithm by a chain of timestamped block hashes that are secured by miners competing computations.
\newline AntsReview is evaluating the advantages of storing the hashes of the peer-reviews into a Merkle Tree to achieve immutability.

\subsubsection{Tokenomics}
AntsReview has few tokens, each of which plays an integral role in the functioning and anonymity of the decentralized protocol.
\newline Ant, is the primary protocol token and can be staked into an AntReview if you wish to provide the protocol with an additional security promise.
\newline Ant [\ref{appendix:c}] is implemented by inheriting ERC20PresetMinterPauser.sol from OpenZeppelin Library with name: Ant ans symbol: ANT.
\newline An AntReview, issued by an author will be seen as a poll where Anters (members of the AntsReview Community) can stake ether or tokens from DeFi services including Dai, Chai, ... with the possibity to accrue interest for the duration of an AntReview (1 year on average), via MakerDAO DSR or Compound to cite a few.
\newline An AntsReview DAO will be formed in the future to allow Ant stakers the ability to participates in a Decentralized Autonomous Organization which will be used to govern important aspects of the decentralized protocol, from smart contracts upgrades to more minor changes in settings accross the protocol.
\newline Hive, When a Anter deposits into an AntReview, they will instantly receive the Hive token which represents their deposit and the accrued interest it gains over time in the AntReview.
\newline This token doesn't need to be locked in the network and it can be traded, sold, or held as the Anter desires.
\newline Hive will be implemented using a similar approach to Ant and Chai, a token that accures interest from MakerDAO's DSR (Dai Saving Rate)
\newline Ideally, but is still under investigation, after the deadline of the AntReview is reached, the Hive token will be burned for Ant and wraped into zkAnt to allow anonymity and send equally to the peer-reviewers that fulfilled the AntReview.
\newline zkAnt, is token wraped into AZTEC Protocol zkSNARKs, that will be extended to PLONK Proof to collapse the gas costs of private transactions on mainnet.
\newline zkAnt will be implemented via AZTEC 2.0 that will allow to securily wrap the Ant Token into zkAnt, allowing private transactions on mainnet and preserving the anonymity of Peer Reviewers.
\newline Finally, another concept under investigation is Quadratic Funding, used by Gitcoin to match donations for Grants. This will allow to incentives prolific Peer-Reviewers and improve the stability of the system together with ideally a reward system to rank best Peer-Reviewers.
\subsubsection{Privacy}

The Anonymity of an agent in the system is achieved in two ways:

\begin{itemize}
  \item PseudoAnonimity granted by an Etherum address that can obscure the identity of the agent.
  \item Private Transactions thanks to AZTEC Protocol security layer via zkAnt.
\end{itemize}

\section{Discussions}
\subsection{A new community-driven standard?}
- a change is already happening: specially new born publishers are opening up review process (BioMed Central, ELife, Frontiers, PeerJ, F1000 Research) -- from 2020 also Nature declared that will do the same.

- new business model? at some point pre-print platforms (dissemination) might want to integrate peer-review (validation) into their platforms - dissociation of initial scientific dissemination and scientific validation will force publishing industry to adapt: how will they justify their added value? as Tennant points out: branding archiving

- peer reviews requires a standard: building smart-contracts for peer-reviews might set a first step in this direction

- community-organized peer  reviews: peer reviews will be more and more out of the hands of publishers, researchers will be the ones seeking the papers to review (like in Rubriq).

future of quality control and moderation: open participation model, community-driven | certification and reputation: expansion of reviewer pool with fewer barriers to enter and more inclusion of young scientists, reputation build within community and not journals

- portable peer review not only within a consortium of journals

-value of peer review as 'academic capital' recognized by research funders and hiring committees

-a bit off topic but: automated peer review (services such as StatReviewers) might fasten the formal aspects of the job allowing reviewers to focus on the content.

\subsubsection{Perspectives for a Decentralized Autonomours Organization (DAO)}

\section{Conclusion}
In this paper we addressed a central problem within the quality control academic dissemination: the peer-review process. We showed how blockchain technology could provide an efficient and viable solution and open up possibile directions for a change in paradigm in scientific communication. We proposed an incentive mechanism that could solve the problems of lack of acknowledgment and trust during peer-review. We exposed the architecture of our project and our Proof of Concept (PoC) for which we adopted cutting-edge tools from the open source blockchain community.

\subsubsection{Supplementary material}
Our open source code is available at the Github repository. A demo of the project is available at Youtube channel.

\subsubsection{CRediT Authorship Contribution Statement}
TDB

\subsubsection{Declaration of Competing Interest}
The authors declare no competing interests.

\subsubsection{Acknowledgements} We would like to thank Matteo A. Tambussi and Keno Budde for internal review and useful comments.

\newpage

\section{Appendix}

\appendix

\section{AntsReviewRoles.sol}
\label{appendix:a}

\begin{lstlisting}[language=Solidity]

  /// SPDX-License-Identifier: GPL-3.0
  pragma solidity 0.6.8;

  ///@title AntsReview
  ///@author Nazzareno Massari
  ///@notice AntsReviewRoles Access Management for Issuer and Peer-Reviewer
  ///@dev All function calls are currently implemented without side effecs through TDD approach
  ///@dev OpenZeppelin library is used for secure contract development

  import "@openzeppelin/contracts/access/Ownable.sol";
  import "@openzeppelin/contracts/access/AccessControl.sol";
  import "@openzeppelin/contracts/utils/Pausable.sol";

  contract AntsReviewRoles is Ownable, AccessControl, Pausable {

    /// Roles
    bytes32 public constant ISSUER_ROLE = keccak256("ISSUER_ROLE");
    bytes32 public constant PEER_REVIEWER_ROLE = keccak256("PEER_REVIEWER_ROLE");
    bytes32 public constant PAUSER_ROLE = keccak256("PAUSER_ROLE");


    constructor() public {
            _setupRole(DEFAULT_ADMIN_ROLE, owner());
            _setupRole(PAUSER_ROLE, owner());
    }

      /// Modifiers
      modifier onlyAdmin() {
          require(isAdmin(msg.sender), "Caller is not an admin");
          _;
        }

      modifier onlyIssuer() {
          require(isIssuer(msg.sender), "Caller is not an issuer");
          _;
      }

      modifier onlyPeerReviewer() {
          require(isPeerReviewer(msg.sender), "Caller is not a peer-reviewer");
          _;
      }

      /// Functions

      function isAdmin(address account) public view returns (bool) {
        return hasRole(DEFAULT_ADMIN_ROLE, account);
      }

      function isIssuer(address account ) public view returns (bool) {
        return hasRole(ISSUER_ROLE, account);
      }

      function isPeerReviewer(address account ) public view returns (bool) {
        return hasRole(PEER_REVIEWER_ROLE, account);
      }

      function addIssuer(address account) public onlyAdmin returns (bool) {
        require(!isIssuer(account), "Account is already an issuer");
        grantRole(ISSUER_ROLE, account);
        return true;
      }

      function addPeerReviewer(address account) public onlyAdmin returns (bool) {
        require(!isPeerReviewer(account), "Account is already a peer-reviewer");
        grantRole(PEER_REVIEWER_ROLE, account);
        return true;
      }

      function removeIssuer(address account) public onlyAdmin returns (bool) {
        require(isIssuer(account), "Account is not an issuer");
        revokeRole(ISSUER_ROLE, account);
        return true;
      }

      function removePeerReviewer(address account) public onlyAdmin returns (bool) {
        require(isPeerReviewer(account), "Account is not a peer-reviewer");
        revokeRole(PEER_REVIEWER_ROLE, account);
        return true;
      }

      /// @notice Pause all the functions
      /// @dev the caller must have the 'PAUSER_ROLE'
      function pause() public {
        require(hasRole(PAUSER_ROLE, msg.sender), "BadgeFactory: must have pauser role to pause");
        _pause();
      }

      /// @notice Unpause all the functions
      /// @dev the caller must have the 'PAUSER_ROLE'
      function unpause() public {
            require(hasRole(PAUSER_ROLE, msg.sender), "BadgeFactory: must have pauser role to unpause");
            _unpause();
      }
  }

\end{lstlisting}

\newpage
\section{AntsReview.sol}
\label{appendix:b}

\begin{lstlisting}[language=Solidity]
  /// SPDX-License-Identifier: GPL-3.0
  pragma solidity 0.6.8;

  ///@title AntsReview
  ///@author Nazzareno Massari
  ///@notice AntsReview to allows issuer to issue an antReview which peer-reviewers can fulfill
  ///@dev All function calls are currently implemented without side effecs through TDD approach
  ///@dev OpenZeppelin library is used for secure contract development

  import "./AntsReviewRoles.sol";
  import "@openzeppelin/contracts/math/SafeMath.sol";
  import "@openzeppelin/contracts/utils/Address.sol";
  import "@openzeppelin/contracts/utils/Counters.sol";

  interface AntToken {
    function transfer(address reciptient, uint amount) external returns (bool);
    function balanceOf(address account) external view returns (uint);
  }

  contract AntsReview is AntsReviewRoles {

    using SafeMath for uint256;
    using Address for address payable;
    using Counters for Counters.Counter;

    /// Enums
    enum AntReviewStatus { CREATED, ACCEPTED, CANCELLED }

    /// Token
    AntToken internal ant;

    /// Counter
    Counters.Counter private _antReviewIdTracker;

    /// Storage
    AntReview[] public antreviews;

    mapping(uint256 => Peer_Review[]) peer_reviews;

    /// Structs
    struct AntReview {
        address payable issuer;
        uint256 deadline;
        string ipfs_hash;
        AntReviewStatus status;
        uint256 amount; //in wei
    }

    struct Peer_Review {
        bool accepted;
        address payable peer_reviewer;
        string ipfs_hash;
    }


    /// Events

    event AntReviewIssued(address issuer, uint256 amount, string ipfsHash);
    event AntReviewFulfilled(uint256 antReviewId, address peer_reviewer, uint256 peerReviewId, string ipfsHash);
    event AntReviewAccepted(uint256 antReviewId, address issuer, address peer_reviewer, uint256 indexed peerReviewId, uint256 amount);
    event AntReviewCancelled(uint256 indexed antReviewId, address indexed issuer, uint256 amount);

    constructor(address ant_) public {
      ant = AntToken(ant_);
    }

    /// Fallback

    fallback() external payable {
      revert();
    }

    receive() external payable {
      revert();
    }

    /// Modifiers

    modifier hasValue() {
        require(msg.value > 0);
        _;
    }

    modifier antReviewExists(uint256 _antReviewId){
      require(_antReviewId < antreviews.length);
      _;
    }

    modifier peerReviewExists(uint256 _antReviewId, uint256 _peerReviewId){
      require(_peerReviewId < peer_reviews[_antReviewId].length);
      _;
    }

    modifier hasStatus(uint256 _antReviewId, AntReviewStatus _desiredStatus) {
      require(antreviews[_antReviewId].status == _desiredStatus);
      _;
    }

    modifier peerReviewNotYetAccepted(uint256 _antReviewId, uint256 _peerReviewId) {
      require(peer_reviews[_antReviewId][_peerReviewId].accepted == false);
      _;
    }

    modifier validateDeadline(uint256 _newDeadline) {
        require(_newDeadline > now);
        _;
    }

    modifier isBeforeDeadline(uint256 _antReviewId) {
      require(now < antreviews[_antReviewId].deadline);
      _;
    }


    ///@notice Instantiates a new AntReview
    ///@dev Access restricted to Issuer
    ///@param _deadline The unix timestamp after which fulfillments will no longer be accepted
    ///@param _ipfsHash The IPFS Hash of the Scientific Paper
    ///@return True If the antReview is successfully issued
    function issueAntReview(
        string calldata _ipfsHash,
        uint64 _deadline
    )
        external
        payable
        hasValue()
        validateDeadline(_deadline)
        onlyIssuer()
        whenNotPaused()
        returns (bool)
    {
        _antReviewIdTracker.increment();
        antreviews.push(AntReview(msg.sender, _deadline, _ipfsHash, AntReviewStatus.CREATED, msg.value));
        emit AntReviewIssued(msg.sender, msg.value, _ipfsHash);
        return true;
    }


    ///@notice Submit a fulfillment for the given antReview
    ///@dev Access restricted to Peer-Reviewer
    ///@param _antReviewId The index of the antReview to be fufilled
    ///@param _ipfsHash The IPFS Hash which contains evidence of the fufillment
    ///@return True If the AntReview is successfully fulfilled
    function fulfillAntReview(uint256 _antReviewId, string memory _ipfsHash)
      public
      antReviewExists(_antReviewId)
      onlyPeerReviewer()
      hasStatus(_antReviewId, AntReviewStatus.CREATED)
      isBeforeDeadline(_antReviewId)
      whenNotPaused()
      returns (bool)
    {
      peer_reviews[_antReviewId].push(Peer_Review(false, msg.sender, _ipfsHash));
      emit AntReviewFulfilled(_antReviewId, msg.sender, (peer_reviews[_antReviewId].length.sub(1)),_ipfsHash);
      return true;
    }


    ///@notice Accept a given Peer-Review
    ///@dev Access restricted to Issuer
    ///@param _antReviewId the index of the antReview
    ///@param _peerReviewId the index of the fulfillment being accepted
    ///@return True If the AntReview is successfully being accepted
    function acceptAntReview(uint256 _antReviewId, uint256 _peerReviewId)
        public
        antReviewExists(_antReviewId)
        peerReviewExists(_antReviewId,_peerReviewId)
        onlyIssuer()
        hasStatus(_antReviewId, AntReviewStatus.CREATED)
        peerReviewNotYetAccepted(_antReviewId, _peerReviewId)
        whenNotPaused()
        returns (bool)
    {
        peer_reviews[_antReviewId][_peerReviewId].accepted = true;
        antreviews[_antReviewId].status = AntReviewStatus.ACCEPTED;
        peer_reviews[_antReviewId][_peerReviewId].peer_reviewer.sendValue(antreviews[_antReviewId].amount);
        emit AntReviewAccepted(
          _antReviewId,
          antreviews[_antReviewId].issuer,
          peer_reviews[_antReviewId][_peerReviewId].peer_reviewer,
          _peerReviewId, antreviews[_antReviewId].amount
        );
        return true;
    }


    ///@notice Cancels the antReview and send the funds back to the issuer
    ///@dev Access restricted to Issuer
    ///@param _antReviewId the index of the antReview
    ///@return True If the AntReview is successfully cancelled
    function cancelAntReview(uint256 _antReviewId)
        public
        antReviewExists(_antReviewId)
        onlyIssuer()
        hasStatus(_antReviewId, AntReviewStatus.CREATED)
        whenNotPaused()
        returns (bool)
    {
        antreviews[_antReviewId].status = AntReviewStatus.CANCELLED;
        antreviews[_antReviewId].issuer.sendValue(antreviews[_antReviewId].amount);
        emit AntReviewCancelled(_antReviewId, msg.sender, antreviews[_antReviewId].amount);
        return true;
    }

  }

\end{lstlisting}

\newpage
\section{Ant.sol}
\label{appendix:c}

\begin{lstlisting}[language=Solidity]
  /// SPDX-License-Identifier: GPL-3.0
  pragma solidity 0.6.8;

  ///@title AntsReview
  ///@author Nazzareno Massari
  ///@notice Ant ERC20 Token
  ///@dev All function calls are currently implemented without side effecs through TDD approach
  ///@dev OpenZeppelin library is used for secure contract development

  import "@openzeppelin/contracts/presets/ERC20PresetMinterPauser.sol";


  contract Ant is ERC20PresetMinterPauser {

    constructor()
    ERC20PresetMinterPauser("Ant", "ANT")
    public {

    }

  }
\end{lstlisting}


% ---- Bibliography ----
%
% BibTeX users should specify bibliography style 'splncs04'.
% References will then be sorted and formatted in the correct style.
%
\bibliographystyle{splncs04}
\bibliography{references.bib}

\end{document}
